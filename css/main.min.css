!function(e,t,i,s,n,o,a){e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,o=t.createElement(i),a=t.getElementsByTagName(i)[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",a.parentNode.insertBefore(o,a)}(window,document,"script",0,"ga"),ga("create","UA-53425526-1","auto"),ga("send","pageview");var genRand=function(e=0,t=Number.MAX_SAFE_INTEGER){return Math.floor(e+Math.random()*(t+1-e))},isMobile=$(window).width()<1200,dpi="300";$("body").removeClass("loading"),$("#write").prop("disabled",!1);var canvas=document.createElement("canvas"),sprites=[],sendText=function(){console.log("sendText");var e=$("#text").val();$.ajax({url:"//api.coo.by/writer/list_test",type:"POST",data:{text:e},dataType:"json",success:function(e){loadSprites(e[0])}})},loadSprites=function(e){console.log("loadSprites");var t=Object.keys(e);if(t.every(e=>sprites.hasOwnProperty(e)))renderList(e);else for(var i=0,s=0;s<t.length;s++)if(sprites.hasOwnProperty(t[s]))++i>=t.length&&renderList(e);else{var n=new Image;n.src="./writer_core/cursives/kate/bitmaps/sprites/tiny/"+dpi+"dpi/"+t[s]+".png",n.onload=function(){++i>=t.length&&renderList(e)},sprites[t[s]]=n}},renderList=function(e){console.log("renderList");var t=canvas.getContext("2d"),i=dpi/600;canvas.width=4960*i,canvas.height=7016*i,t.fillStyle="#fff",t.fillRect(0,0,canvas.width,canvas.height),$.each(e,function(e,s){s.forEach(s=>{t.drawImage(sprites[e],s[2][0]*i,s[2][1]*i,s[2][2]*i,s[2][3]*i,s[0]*i,s[1]*i,s[2][2]*i,s[2][3]*i)})}),showList(canvas)},lists_count=0;$("#write").click(function(){lists_count++,isMobile&&$("body").addClass("loading"),$("#write").prop("disabled",!0),$(".clipboard").addClass("loading"),sendText(),2!=lists_count&&lists_count%3!=0||openPopup()}),$("#text").keydown(function(e){if(9===e.keyCode){var t=this.value,i=this.selectionStart,s=this.selectionEnd;return this.value=t.substring(0,i)+"\t"+t.substring(s),this.selectionStart=this.selectionEnd=i+1,!1}e.ctrlKey&&13==e.keyCode&&($("#write").prop("disabled",!0),$(".clipboard").addClass("loading"),sendText())});var showList=function(e){console.log("showList"),$("#list_img").attr("crossorigin","anonymous"),$("#list_img").attr("src",e.toDataURL()),$("#list").show(),$(".clipboard").removeClass("loading"),$("body").removeClass("loading"),$("#write").prop("disabled",!1)};$("#text").bind("keydown input propertychange",function(){""!==$("#text").val()?$("#write").show():$("#write").hide()}),$("#list").click(function(){isMobile&&$("#list").hide()});var openPopup=function(){console.log("openPopup"),$(".popup").fadeIn(200),$(".popup").slideDown(200,function(){$(".env_list").slideDown(800)})},closePopup=function(){$(".env_list").slideUp(400,function(){$(".popup").hide(0,function(){})})};$(".env_list_x, .popup").click(function(e){e.target===this&&closePopup()});