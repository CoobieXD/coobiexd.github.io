!function(e,t,i,s,o,n,a){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,n=t.createElement(i),a=t.getElementsByTagName(i)[0],n.async=1,n.src="https://www.google-analytics.com/analytics.js",a.parentNode.insertBefore(n,a)}(window,document,"script",0,"ga"),ga("create","UA-53425526-1","auto"),ga("send","pageview");var genRand=function(e=0,t=Number.MAX_SAFE_INTEGER){return Math.floor(e+Math.random()*(t+1-e))},isMobile=$(window).width()<1200,dpi="300";$("body").removeClass("loading"),$("#write").prop("disabled",!1);var api_timer,canvas=document.createElement("canvas"),sprites=[],api_url="https://api0.coo.by/writer/list.php?ping",sendText=function(e=3e3){console.log("sendText");var t=$("#text").val();$.ajax({url:api_url,type:"POST",data:{text:t},dataType:"json",timeout:e,success:function(e){console.log("success",api_url),"ok"==e.status&&loadSprites(e.lists[0])},error:function(e){console.log("error",api_url),clearInterval(api_timer),api_timer=setInterval(function(){api_url="https://api0.coo.by/writer/list.php?ping"},3e4),api_url="https://api.coo.by/writer/list.php?ping",sendText(3e4)}})},loadSprites=function(e){console.log("loadSprites");var t=Object.keys(e);if(t.every(e=>sprites.hasOwnProperty(e)))renderList(e);else for(var i=0,s=0;s<t.length;s++)if(sprites.hasOwnProperty(t[s]))++i>=t.length&&renderList(e);else{var o=new Image;o.src="./writer_core/cursives/kate/bitmaps/sprites/tiny/"+dpi+"dpi/"+t[s]+".png",o.onload=function(){++i>=t.length&&renderList(e)},sprites[t[s]]=o}},renderList=function(e){console.log("renderList");var t=canvas.getContext("2d"),i=dpi/600;canvas.width=4960*i,canvas.height=7016*i,t.fillStyle="#fff",t.fillRect(0,0,canvas.width,canvas.height),$.each(e,function(e,s){s.forEach(s=>{t.drawImage(sprites[e],s[2][0]*i,s[2][1]*i,s[2][2]*i,s[2][3]*i,s[0]*i,s[1]*i,s[2][2]*i,s[2][3]*i)})}),showList(canvas)},lists_count=0;$("#write").click(function(){lists_count++,isMobile&&$("body").addClass("loading"),$("#write").prop("disabled",!0),$(".clipboard").addClass("loading"),sendText(),lists_count%3==0&&openPopup()}),$("#text").keydown(function(e){if(9===e.keyCode){var t=this.value,i=this.selectionStart,s=this.selectionEnd;return this.value=t.substring(0,i)+"\t"+t.substring(s),this.selectionStart=this.selectionEnd=i+1,!1}e.ctrlKey&&13==e.keyCode&&($("#write").prop("disabled",!0),$(".clipboard").addClass("loading"),sendText())});var showList=function(e){console.log("showList"),$("#list_img").attr("crossorigin","anonymous"),$("#list_img").attr("src",e.toDataURL()),$("#list").show(),$(".clipboard").removeClass("loading"),$("body").removeClass("loading"),$("#write").prop("disabled",!1)};$("#text").bind("keydown input propertychange",function(){""!==$("#text").val()?$("#write").show():$("#write").hide()}),$("#list").click(function(){isMobile&&$("#list").hide()});var openPopup=function(){console.log("openPopup"),$(".popup").fadeIn(200),$(".popup").slideDown(200,function(){$(".env_list").slideDown(800)})},closePopup=function(){$(".env_list").slideUp(400,function(){$(".popup").hide(0,function(){})})};$(".env_list_x, .popup").click(function(e){e.target===this&&closePopup()});