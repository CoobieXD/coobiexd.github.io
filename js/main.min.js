!function(e,t,s,i,o,n,a){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,n=t.createElement(s),a=t.getElementsByTagName(s)[0],n.async=1,n.src="https://www.google-analytics.com/analytics.js",a.parentNode.insertBefore(n,a)}(window,document,"script",0,"ga"),ga("create","UA-53425526-1","auto"),ga("send","pageview");var genRand=function(e=0,t=Number.MAX_SAFE_INTEGER){return Math.floor(e+Math.random()*(t+1-e))},isMobile=$(window).width()<1200,dpi="300";$("body").removeClass("loading"),$("#write").prop("disabled",!1);var canvas=document.createElement("canvas"),sprites=[],sendText=function(e="https://api0.coo.by/writer/list.php?ping",t=3e3){console.log("sendText");var s=$("#text").val();$.ajax({url:e,type:"POST",data:{text:s},dataType:"json",timeout:t,success:function(t){console.log("success",e),"ok"==t.status&&loadSprites(t.lists[0])},error:function(t){console.log("error",e),sendText("https://api.coo.by/writer/list.php?ping",3e4)}})},loadSprites=function(e){console.log("loadSprites");var t=Object.keys(e);if(t.every(e=>sprites.hasOwnProperty(e)))renderList(e);else for(var s=0,i=0;i<t.length;i++)if(sprites.hasOwnProperty(t[i]))++s>=t.length&&renderList(e);else{var o=new Image;o.src="./writer_core/cursives/kate/bitmaps/sprites/tiny/"+dpi+"dpi/"+t[i]+".png",o.onload=function(){++s>=t.length&&renderList(e)},sprites[t[i]]=o}},renderList=function(e){console.log("renderList");var t=canvas.getContext("2d"),s=dpi/600;canvas.width=4960*s,canvas.height=7016*s,t.fillStyle="#fff",t.fillRect(0,0,canvas.width,canvas.height),$.each(e,function(e,i){i.forEach(i=>{t.drawImage(sprites[e],i[2][0]*s,i[2][1]*s,i[2][2]*s,i[2][3]*s,i[0]*s,i[1]*s,i[2][2]*s,i[2][3]*s)})}),showList(canvas)},lists_count=0;$("#write").click(function(){lists_count++,isMobile&&$("body").addClass("loading"),$("#write").prop("disabled",!0),$(".clipboard").addClass("loading"),sendText(),2!=lists_count&&lists_count%3!=0||openPopup()}),$("#text").keydown(function(e){if(9===e.keyCode){var t=this.value,s=this.selectionStart,i=this.selectionEnd;return this.value=t.substring(0,s)+"\t"+t.substring(i),this.selectionStart=this.selectionEnd=s+1,!1}e.ctrlKey&&13==e.keyCode&&($("#write").prop("disabled",!0),$(".clipboard").addClass("loading"),sendText())});var showList=function(e){console.log("showList"),$("#list_img").attr("crossorigin","anonymous"),$("#list_img").attr("src",e.toDataURL()),$("#list").show(),$(".clipboard").removeClass("loading"),$("body").removeClass("loading"),$("#write").prop("disabled",!1)};$("#text").bind("keydown input propertychange",function(){""!==$("#text").val()?$("#write").show():$("#write").hide()}),$("#list").click(function(){isMobile&&$("#list").hide()});var openPopup=function(){console.log("openPopup"),$(".popup").fadeIn(200),$(".popup").slideDown(200,function(){$(".env_list").slideDown(800)})},closePopup=function(){$(".env_list").slideUp(400,function(){$(".popup").hide(0,function(){})})};$(".env_list_x, .popup").click(function(e){e.target===this&&closePopup()});